<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>cat jump</title>
  <style>
    html,
    body {
        width: 100%;
        height: 100%;
    },
    element.style{
            height: 100%;
    }
  </style>
</head>
<body>

<script type="module">

// import kaboom lib
import kaboom from "https://unpkg.com/kaboom@next/dist/kaboom.mjs";
// initialize kaboom context

kaboom({
    width:352,
    height: 352,
    scale: 2,
    clearColor: [149, 222, 158, 87],
    crisp: false,
    global: true,
    fullscreen: true,
    // canvas: document.getElementById("game")
});

function randBetween(min, max) {
    return Math.random() * (max - min) + min;
}


    const TILE_W = 16;
    const TILE_H = 16;
    const WALL = 50;
    const FLOOR = 65;
    const SIGN_RIGHT = 93;
    const SIGN_LEFT = 92;
    const PRIZE = 96;
    let angle = 0;

    gravity(1000);
    let stamina = 3;
    let jumpiness = 5;
    

loadSprite("cat", "cat.png");

loadSprite("tiles", "monochrome_tilemap_transparent_packed.png", {
    sliceX: 20,
    sliceY: 20,
});
scene("main", () => {


    const cat = add([
        sprite("cat"),
        pos(352/2, 352/2),
        origin("center"),
        body({maxVel: 1000,}),
        area(),
    ]);


    let dest = vec2(0,0);
    let timeleft = 60
    let score = 0;
    cat.action(() => {
        dest.y = 0
        cat.moveTo(vec2(dest.x,dest.y), jumpiness);
        if(stamina==0){
            cat.color = rgb(255, 1, 1);
        }
        if(stamina==1){
            cat.color = rgb(255, 128, 1);
        }
        if(stamina==2){
            cat.color = rgb(255, 255, 1);
        }
        if(stamina==3){
            cat.color = rgb(255, 255, 255);
        }
    });

    cat.collides("food", (f) => {
        destroy(f);
        score++;
        updatescore()
    });

    cat.on("ground", () => {
        jumpiness = 0
        console.log("horray!");
    })

    mouseClick(() => {
        if (stamina >= 1){
            stamina-= 1;
            dest = mousePos();
            cat.jump(100);
            jumpiness = 5
           
        }
         updatescore()
        // cat.moveTo(dest, 10);
    });


    addLevel([
        "!====================!",
        "!                    !",
        "!                    !",
        "!      %             !",
        "!    ===             !",
        "!                    !",
        "!                 ===!",
        "!===                 !",
        "!                    !",
        "!                    !",
        "!!!                  !",
        "!=====             !!!",
        "!                 !!!!",
        "!                !!!!!",
        "!                !!!!!",
        "!                !!!!!",
        "!                !!!!!",
        "!                !!!!!",
        "!                !!!!!",
        "!                !!!!!",
        "!                !!!!!",
        "!====================!"
    ], {
        width: TILE_W,
        height: TILE_H,
        "=": [
            sprite("tiles", {
                frame: FLOOR,
            }),
            area(),
            // area(vec2(0, 0), vec2(TILE_W, 16)),
            solid(),
        ],
        "!": [
            sprite("tiles", {
                frame: WALL,
            }),
            area(),
            solid(),
        ],
        "<": [
            sprite("tiles", {
                frame: SIGN_LEFT,
            }),
            area(),
            color(0, 1, 0),
            solid(),
        ],
        ">": [
            sprite("tiles", {
                frame: SIGN_RIGHT,
            }),
            area(),
            color(0, 1, 0),
            solid(),
        ],
    });

    loop(1, () => {
        if(stamina==0){
            //pass
            stamina+=1;
        }else{
            stamina+=1;
            if(stamina > 3){
                stamina=3;
            }
        }
        updatescore()

    });


    function updatescore() {
        debug.clearLog();
        timeleft = Math.ceil(timeleft=60-time());
        debug.log("stamina: " + String(stamina) + "/3" + "  " + " score: " + String(score) + "  time remaining: " + String(timeleft) + " seconds");
        if (timeleft <= 0){
            go("gameover", score);
        }

    }

    function add_food(){
        add([
            sprite("tiles",{frame: choose([40,41,42])}),
            pos(randBetween(25,352-25), 20),
            origin("center"),
            // body({maxVel: 100,}),
            area(),
            "food"
        ]);  
    }

    loop(randBetween(2,10), () => {
        if (time() > 5){
        add_food()
        }
    });

    loop(randBetween(2,10), () => {
        if (time() > 5){
        add_food()
        }
    });

    loop(randBetween(10,15), () => {
        if (time() > 5){
            add_food()
            add_food()
            add_food()
            add_food()
            add_food()
            add_food()
            add_food()
            add_food()
        }
    });

    loop(1, () => {
        updatescore()
    });

    on("update", "food", (food) => {
        food.pos.y += 2*randBetween(0.8,1.2);
        if(food.pos.y < (1*food.width))
            destroy(food);
    });
});

scene("gameover", (score) => {
    // display score passed by scene "main"
    add([
        text('ur score'),
    ]);
    add([
        text(score),
        pos(0, 100),
    ]);
    add([
        text('nice :)'),
        pos(0, 200),
    ]);
    mouseClick(() => {
        timeleft = 60
        score = 0
        go("main")
    });
});

go("main");

</script>
</body>
</html>
